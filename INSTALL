#!/bin/bash

############################################################
##                                                        ##
## install pySeqRNA                                       ## 
## Author: Naveen Duhan                                   ##
##                                                        ##
############################################################

# Function to check if a command is available
command_exists() {
  command -v "$1" >/dev/null 2>&1
}

# Check operating system
OS=$(uname -s)

# Check if Miniconda is already installed
if [ ! -d "$HOME/miniconda3" ]; then
  echo "Miniconda is not installed. Installing..."
  
  # Download Miniconda installer based on OS and architecture
  if [ "$OS" = "Linux" ]; then
      wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
  elif [ "$OS" = "Darwin" ]; then
      ARCH=$(uname -m)
      if [[ "$ARCH" == "arm64" ]]; then
          wget https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-arm64.sh -O miniconda.sh
          conda config --env --set subdir osx-arm64
      else
          wget https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-x86_64.sh -O miniconda.sh
      fi
  else
      echo "Unsupported operating system: $OS"
      exit 1
  fi
  
  # Install Miniconda unattendedly
  bash miniconda.sh -b -p ~/miniconda3
fi

# Activate Miniconda
source ~/miniconda3/bin/activate

# Check if the conda environment already exists
if conda env list | grep -q "pyseqrna-0.2"; then
  echo "pySeqRNA environment already exists. Deleting and recreating..."
  conda env remove -n pyseqrna-0.2 --yes
fi

# Install dependencies via conda
conda env create -f pyseqrna_environment.yml

# Activate the environment
conda activate pyseqrna-0.2

# Install pySeqRNA
pip install .



##################################################################
##                                                              ##
##  Written by Naveen Duhan (naveen.duhan@outlook.com)          ##
##  Kaundal Bioinformatics Lab, Utah State University           ##
##  Released under the terms of GNU General Public Licence v3   ## 
##                                                              ##
##################################################################